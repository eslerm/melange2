package:
  name: cache-dir-test
  version: 1.0.0
  epoch: 0
  description: Test --cache-dir host filesystem mount

environment:
  contents:
    packages:
      - busybox

pipeline:
  - name: Read from cache directory
    runs: |
      # Read cached artifact from /var/cache/melange
      mkdir -p ${{targets.destdir}}/usr/share/cache-dir-test

      # Copy the cached artifact to output
      if [ -f /var/cache/melange/test-artifact.txt ]; then
        cp /var/cache/melange/test-artifact.txt ${{targets.destdir}}/usr/share/cache-dir-test/
        echo "found" > ${{targets.destdir}}/usr/share/cache-dir-test/status.txt
      else
        echo "not-found" > ${{targets.destdir}}/usr/share/cache-dir-test/status.txt
      fi
